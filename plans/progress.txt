2026-02-20 — Database schema models added

Added ScheduleEntry, FoodEntry, AiAnalysis models to prisma/schema.prisma.
All three reference User.id as a FK. FoodEntry has @@unique([userId, date, mealType]).
AiAnalysis has @unique on userId (one record per user). All models have @@index([userId]).
Migration 20260220144005_add_schedule_food_ai_models applied successfully to Postgres.

2026-02-20 — Env variable validation added

Updated src/env.js: server validates CLERK_SECRET_KEY, OPENAI_API_KEY, DATABASE_URL;
client validates NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY and all NEXT_PUBLIC_CLERK_*_URL vars.
Updated .env.example with all required variable names and placeholder values.

2026-02-21 — shadcn/ui initialized and components installed

Ran `npx shadcn@latest init --defaults` — detected Tailwind v4, created components.json,
updated globals.css with CSS variables, created src/lib/utils.ts.
Installed: accordion, button, card, sonner, input, textarea, carousel.
embla-carousel-react@^8.6.0 added to package.json as a dependency.

2026-02-21 — Vercel AI SDK installed

ai 6.0.94 + @ai-sdk/openai 3.0.30 pinned in package.json. Provider: openai('gpt-4.1').
OPENAI_API_KEY already validated in env.js.

2026-02-21 — Root layout + desktop max-width

layout.tsx: viewport export, Geist variable on html, font-sans + bg-background on body,
max-w-sm mx-auto wrapper (pb-16 for tab bar), Toaster (bottom-center), title "Ralph".
ThemeProvider (next-themes, defaultTheme="system", enableSystem) — dark/light follows OS.
suppressHydrationWarning on <html>. afterSignOutUrl="/sign-in" moved to ClerkProvider.

2026-02-21 — Tab bar + navigation + settings

src/components/layout/tab-bar.tsx: fixed bottom nav, max-w-sm centered, 4 items.
- Schedule (CalendarDays → /), Food Diary (BookOpen → /food-diary),
  AI Overview (Sparkles → /ai-overview), Settings (Clerk UserButton inline).
- usePathname() drives active state: text-primary + font-semibold + strokeWidth 2.5.
- Inactive tabs: text-muted-foreground + strokeWidth 1.75.
- UserButton opens Clerk modal in-place; URL does not change.
Stub pages created: /food-diary and /ai-overview.

Next priority (PLANS.json): auth-clerk-webhook (unblocks all server actions),
then schedule-server-actions.

2026-02-21 — Auth infrastructure (auth-clerk-webhook + auth-redirect + auth-userid-access)

src/app/api/webhooks/clerk/route.ts: verifies Svix signature via verifyWebhook from
@clerk/nextjs/webhooks. user.created/user.updated → prisma.user.upsert (id, email, name).
user.deleted → prisma.user.deleteMany. Returns 204 on success, 400 on invalid signature.
src/env.js: CLERK_WEBHOOK_SECRET added to server schema. AI_GATEWAY_API_KEY replaces
OPENAI_API_KEY (user is routing through an AI gateway).
src/middleware.ts: /api/webhooks/clerk added to public routes. All other routes protected
via auth.protect(). clerkMiddleware from @clerk/nextjs/server.
src/lib/auth.ts: getRequiredUserId() — calls auth(), throws "Unauthorized" if userId null.
All server actions must use this helper instead of calling auth() directly.

Next priority: schedule-server-actions (now unblocked — auth-userid-access complete).

2026-02-21 — Schedule server actions

Created src/server/actions/schedule.ts with three 'use server' actions:
- createScheduleEntry(weekday, startTime, endTime, activity): inserts row, revalidatePath('/').
- getScheduleEntries(): findMany filtered by userId, ordered by startTime asc.
- deleteScheduleEntry(id): verifies ownership via findFirst, deletes, revalidatePath('/').
All mutations return { success: true } | { success: false; error: string }.
pnpm check + tsc --noEmit both pass.

Next priority: schedule-page (now unblocked — schedule-server-actions + layout-tabbar complete).

2026-02-21 — Schedule page (week carousel + day slide + activity row)

src/app/page.tsx: server component calls getScheduleEntries(), passes entries to WeekCarousel.
src/components/schedule/week-carousel.tsx: 'use client'; useEmblaCarousel({ loop: true,
  startIndex: (getDay()+6)%7 }). Groups entries by weekday (Mon=0…Sun=6). 7 slides.
src/components/schedule/day-slide.tsx: h-[calc(100dvh-4rem)], day name header, scrollable
  activity list with pb-20 gap for future sticky form, 'No activities yet' empty state.
src/components/schedule/activity-row.tsx: '{startTime} – {endTime} · {activity}' layout.
pnpm check + tsc --noEmit pass.

Next priority: schedule-form (AddActivityForm sticky at bottom of each DaySlide).

2026-02-21 — Schedule form (AddActivityForm)

src/components/schedule/add-activity-form.tsx: 'use client'; two time inputs (type=time) +
  text input + Add button. Submit disabled until all fields filled. Calls createScheduleEntry
  server action. On success: clears all fields, toast.success("Activity added"). On error:
  inline <p className="text-destructive"> below form. sticky bottom-0 border-t bg-background.
src/components/schedule/day-slide.tsx: added weekday: number prop, removed pb-20 placeholder,
  mounts <AddActivityForm weekday={weekday} /> as last flex child.
src/components/schedule/week-carousel.tsx: passes weekday={i} to each DaySlide.
pnpm check + tsc --noEmit pass.

Next priority: schedule-interactions (long-press delete + optimistic UI + overlap warning).
